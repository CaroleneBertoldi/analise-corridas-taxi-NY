---
title: "Mapa-dos-quadrantes"
author: "Carolene Bertoldi"
date: "30 de junho de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Preparando bibliotecas
#install.packages("plyr")
#install.packages("dplyr")
#install.packages("plotly")
#install.packages("tidyr")

rm(list = ls())
library(plyr)
library(dplyr)
library(plotly)
library(tidyr)
```

## Mapeamento de quadrantes com endereços importantes de Manhattan

Definidando coordenadas limites da área de NY a ser estudada, no caso Manhattan.

```{r }
cfg <- list(x.min =  40.70, x.max =  40.82, y.step = 0.002,
            y.min = -74.04, y.max = -73.92, x.step = 0.002)

cfg$x.lim <- seq( from = cfg$x.min, to = cfg$x.max, by = cfg$x.step)
cfg$y.lim <- seq( from = cfg$y.min, to = cfg$y.max, by = cfg$y.step)
cfg$x.qtde <- length(cfg$x.lim) -1
cfg$y.qtde <- length(cfg$y.lim) -1
cfg$all.qtde <- cfg$x.qtde * cfg$y.qtde
cfg$x <- paste0('X', seq_len(cfg$x.qtde))
cfg$y <- paste0('Y', seq_len(cfg$y.qtde))
```

Atribuindo nomeclatura generica aos quadrantes.

```{r }
cfg$all <- paste0('q', seq_len(cfg$all.qtde))
names(cfg$all) <- cfg$all

mapa <- matrix(data=cfg$all, nrow = cfg$y.qtde)
colnames(mapa) <- cfg$x
row.names(mapa) <- cfg$y
```

Definindo coordenadas de limites de cada quadrante.

```{r }
mapa.quadrantes <- data.frame(names=cfg$all, row.names = cfg$all)
mapa.quadrantes <- mutate( mapa.quadrantes,
                    x = rep(cfg$x, each=60),
                    y = rep(cfg$y, 60),
                    x.down = rep( cfg$x.lim[1:60], each=60),
                    x.top = rep( cfg$x.lim[2:61], each=60),
                    y.left = rep( cfg$y.lim[1:60], 60),
                    y.rigth = rep( cfg$y.lim[2:61], 60))

tail(mapa.quadrantes, n=100)
```

Mapeando endereços conhecidos da ilha no mapa de quadrantes.

  1. Estações de metrô
  2. Galerias de arte
  3. Bibliotecas
  4. Teatros
  5. Bares e restaurantes

```{r }
#EU QUERO SUBSTITUIR este dataset pontosInteresse que só tem as estação de metro por mais datasets
#ESTE DATASET funciona
pontosInteresse = read.csv('./data/pontos-interesse.csv')
pontosInteresse = mutate(pontosInteresse,
                  Latitude = as.numeric(as.character(pontosInteresse$Latitude)))
#teste demonstrando que os dados estao dentro do range dos limites gerais
teste = pontosInteresse %>%
  filter(Latitude >= 40.70 & Latitude < 40.82 & Longitude >= -74.04 & Longitude < -73.92)

--------------------------------------------------------------------------------------------
#INICIO DE CÓDIGO QUE NÃO FUNCIONA

bares.e.restaurantes = read.csv('./data/bares-e-restaurantes.csv')
bares.e.restaurantes = mutate(bares.e.restaurantes,
                              Local = as.character(bares.e.restaurantes$Local),
                              Nome = as.character(bares.e.restaurantes$Nome),
                              Logradouro = as.character(bares.e.restaurantes$Logradouro),
                              Latitude = as.numeric(as.character(bares.e.restaurantes$Latitude)),
                              Longitude = as.numeric(as.character(bares.e.restaurantes$Longitude))) 

bibliotecas = read.csv('./data/bibliotecas.csv')
bibliotecas = mutate(bibliotecas,
                     Local = as.character(bibliotecas$Local),
                     Nome = as.character(bibliotecas$Nome),
                     Logradouro = as.character(bibliotecas$Logradouro),
                     Latitude = as.numeric(as.character(bibliotecas$Latitude)),
                     Longitude = as.numeric(as.character(bibliotecas$Longitude)))

estacoes.metro = read.csv('./data/estacoes-metro.csv')
estacoes.metro = mutate(estacoes.metro,
                 Local = as.character(estacoes.metro$Local),
                 Nome = as.character(estacoes.metro$Nome),
                 Logradouro = as.character(estacoes.metro$Logradouro),
                 Latitude = as.numeric(as.character(estacoes.metro$Latitude)),
                 Longitude = as.numeric(as.character(estacoes.metro$Longitude)))

galerias.de.arte = read.csv('./data/galerias-de-arte.csv')
galerias.de.arte = mutate(galerias.de.arte,
                   Local = as.character(galerias.de.arte$Local),
                   Nome = as.character(galerias.de.arte$Nome),
                   Logradouro = as.character(galerias.de.arte$Logradouro),
                   Latitude = as.numeric(as.character(galerias.de.arte$Latitude)),
                   Longitude = as.numeric(as.character(galerias.de.arte$Longitude)))

teatros = read.csv('./data/teatros.csv')
teatros = mutate(teatros,
          Local = as.character(teatros$Local),
          Nome = as.character(teatros$Nome),
          Logradouro = as.character(teatros$Logradouro),
          Latitude = as.numeric(as.character(teatros$Latitude)),
          Longitude = as.numeric(as.character(teatros$Longitude)))

pontosInteresse = full_join(bares.e.restaurantes, bibliotecas) %>%
  filter(Latitude >= 40.70 & Latitude < 40.82 & Longitude >= -74.04 & Longitude < -73.92)


# FIM DE CÓSIGO QUE NÃO FUNCIONA
--------------------------------------------------------------------------------------------
#DAQUI EM DIANTE TUDO CONTINUA FUNCIONANDO COM O DATASET pontosInteresse
  
#Identifica a qual quadrante pertencem os pontos de interesse
locais = merge(mapa.quadrantes, pontosInteresse) %>% 
  filter(Latitude >= x.down & Latitude < x.top & Longitude >= y.left & Longitude < y.rigth)

#Enriquece mapa com idetificação dos pontos existentes nos quadrantes
mapa.locais = unique(left_join(mapa.quadrantes, locais)) %>% 
  select(-Latitude, -Longitude)
```
## Corridas de táxi

Enriquecendo dataset de corridas com os pontos de origens e destinos.

```{r }
corridas.taxi.train = read.csv('./data/train.csv')
corridas.taxi = head(corridas.taxi.train, n=100)
```

Origens:
```{r }
corridas.locais.origens = merge(corridas.taxi, mapa.locais) %>% 
  filter(pickup_latitude >= x.down & pickup_latitude < x.top & pickup_longitude >= y.left & pickup_longitude < y.rigth) %>%
  select(-x, -y, -x.down, -x.top, -y.left, -y.rigth)

colnames(corridas.locais.origens)[length(corridas.locais.origens)-2] <- "pickup_quater"
colnames(corridas.locais.origens)[length(corridas.locais.origens)-1] <- "pickup_local_type"
colnames(corridas.locais.origens)[length(corridas.locais.origens)] <- "pickup_local"
```

Destinos:
```{r }
corridas.locais = merge(corridas.locais.origens, mapa.locais) %>% 
  filter(dropoff_latitude >= x.down & dropoff_latitude < x.top & dropoff_longitude >= y.left & dropoff_longitude < y.rigth) %>%
  select(-x, -y, -x.down, -x.top, -y.left, -y.rigth)

colnames(corridas.locais)[length(corridas.locais)-2] <- "dropoff_quater"
colnames(corridas.locais)[length(corridas.locais)-1] <- "dropoff_local_type"
colnames(corridas.locais)[length(corridas.locais)] <- "dropoff_local"
```

## Mapeamento de rotas das corridas

```{r }
```
